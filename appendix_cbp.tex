\chapter{Representation of Models in State and Change-based Persistence}
\label{sec:examples_of_cbp}

\vspace{-20pt}
\begin{lstlisting}[style=xmi,caption={Simplified XMI file of the original version in Figure \ref{fig:class_diagram_origin}.},label=lst:xmimodel_origin]
<uml:Model>
<packagedElement type=Class id="character" name="Character">
<operation id="attack" name="attack">
<parameter id="gem" name="gem"/>
<parameter id="target" name="target"/>
<parameter id="weapon" name="weapon"/>
</operation>
</packagedElement>
<packagedElement type=Class id="troll" name="Troll"/>
<packagedElement type=Class id="giant" name="Giant">
<operation id="cast" name="cast"/>
</packagedElement>
<packagedElement type=Class id="knight" name="Knight">
<operation id="smash" name="smash"/>
</packagedElement>
<packagedElement type=Class id="mage" name="Mage"/>
</uml:Model>
\end{lstlisting}

\vspace{-20pt}
\begin{lstlisting}[style=xmi,caption={Simplified XMI file of the left version in Figure \ref{fig:class_diagram_left}.},label=lst:xmimodel_left]
<uml:Model>
<packagedElement type=Class id="character" name="Hero">
<operation id="attack" name="attack">
<parameter id="weapon" name="weapon"/>
<parameter id="gem" name="gem"/>
<parameter id="target" name="target"/>
</operation>
</packagedElement>
<packagedElement type=Class id="troll" name="Ogre"/>
<packagedElement type=Class id="knight" name="Knight">
<generalization id="leftGen" general="character"/>
<operation id="smash" name="smash"/>
</packagedElement>
<packagedElement type=Class id="mage" name="Mage"/>
</uml:Model>
\end{lstlisting}

\vspace{-20pt}
\begin{lstlisting}[style=xmi,caption={Simplified XMI file of the right version of Figure \ref{fig:class_diagram_right}.},label=lst:xmimodel_right]
<uml:Model>
<packagedElement type=Class id="character" name="Character">
<operation id="attack" name="attack">
<parameter id="gem" name="gem"/>
<parameter id="weapon" name="weapon"/>
<parameter id="target" name="target"/>
</operation>
</packagedElement>
<packagedElement type=Class id="troll" name="Orc"/>
<packagedElement type=Class id="giant" name="Giant">
<operation id="smash" name="smash"/>
</packagedElement>
<packagedElement type=Class id="knight" name="Knight"/>
<packagedElement type=Class id="mage" name="Mage">
<generalization id="rightGen" general="character"/>
<operation id="cast" name="cast"/>
</packagedElement>
</uml:Model>
\end{lstlisting}

\vspace{-20pt}
\begin{lstlisting}[style=cbpfile,caption={Change-based representation of the model in Figure \ref{fig:class_diagram_left}.},label=lst:class_diagram_left_cbpfile]
<session id="ORIGIN" time="20191230131530917GMT"/>
<register epackage="miniuml"/>
<create eclass="Model" epackage="miniuml" id="O-0"/>
<add-to-resource eclass="Model" position="0"><value eclass="Model" eobject="O-0"/></add-to-resource>
<set-eattribute eclass="Model" name="name" target="O-0"><value literal="ROOT"/></set-eattribute>
<create eclass="Class" epackage="miniuml" id="O-1"/>
<add-to-resource eclass="Class" position="1"><value eclass="Class" eobject="O-1"/></add-to-resource>
<set-eattribute eclass="Class" name="name" target="O-1"><value literal="Character"/></set-eattribute>
<create eclass="Operation" epackage="miniuml" id="O-2"/>
<add-to-resource eclass="Operation" position="2"><value eclass="Operation" eobject="O-2"/></add-to-resource>
<set-eattribute eclass="Operation" name="name" target="O-2"><value literal="attack"/></set-eattribute>
<create eclass="Parameter" epackage="miniuml" id="O-3"/>
<add-to-resource eclass="Parameter" position="3"><value eclass="Parameter" eobject="O-3"/></add-to-resource>
<set-eattribute eclass="Parameter" name="name" target="O-3"><value literal="gem"/></set-eattribute>
<create eclass="Parameter" epackage="miniuml" id="O-4"/>
<add-to-resource eclass="Parameter" position="4"><value eclass="Parameter" eobject="O-4"/></add-to-resource>
<set-eattribute eclass="Parameter" name="name" target="O-4"><value literal="target"/></set-eattribute>
<create eclass="Parameter" epackage="miniuml" id="O-5"/>
<add-to-resource eclass="Parameter" position="5"><value eclass="Parameter" eobject="O-5"/></add-to-resource>
<set-eattribute eclass="Parameter" name="name" target="O-5"><value literal="weapon"/></set-eattribute>
<remove-from-resource composite="_EuXu4Cr-EeqlN5gavj_cGQ" eclass="Operation" position="2"><value eclass="Operation" eobject="O-2"/></remove-from-resource>
<add-to-ereference composite="_EuXu4Cr-EeqlN5gavj_cGQ" eclass="Class" name="operations" position="0" target="O-1"><value eclass="Operation" eobject="O-2"/></add-to-ereference>
<remove-from-resource composite="_EuXu4Sr-EeqlN5gavj_cGQ" eclass="Parameter" position="2"><value eclass="Parameter" eobject="O-3"/></remove-from-resource>
<add-to-ereference composite="_EuXu4Sr-EeqlN5gavj_cGQ" eclass="Operation" name="parameters" position="0" target="O-2"><value eclass="Parameter" eobject="O-3"/></add-to-ereference>
<remove-from-resource composite="_EuXu4ir-EeqlN5gavj_cGQ" eclass="Parameter" position="2"><value eclass="Parameter" eobject="O-4"/></remove-from-resource>
<add-to-ereference composite="_EuXu4ir-EeqlN5gavj_cGQ" eclass="Operation" name="parameters" position="1" target="O-2"><value eclass="Parameter" eobject="O-4"/></add-to-ereference>
<remove-from-resource composite="_EuXu4yr-EeqlN5gavj_cGQ" eclass="Parameter" position="2"><value eclass="Parameter" eobject="O-5"/></remove-from-resource>
<add-to-ereference composite="_EuXu4yr-EeqlN5gavj_cGQ" eclass="Operation" name="parameters" position="2" target="O-2"><value eclass="Parameter" eobject="O-5"/></add-to-ereference>
<create eclass="Class" epackage="miniuml" id="O-6"/>
<add-to-resource eclass="Class" position="2"><value eclass="Class" eobject="O-6"/></add-to-resource>
<set-eattribute eclass="Class" name="name" target="O-6"><value literal="Troll"/></set-eattribute>
<create eclass="Class" epackage="miniuml" id="O-7"/>
<add-to-resource eclass="Class" position="3"><value eclass="Class" eobject="O-7"/></add-to-resource>
<set-eattribute eclass="Class" name="name" target="O-7"><value literal="Giant"/></set-eattribute>
<create eclass="Operation" epackage="miniuml" id="O-8"/>
<add-to-resource eclass="Operation" position="4"><value eclass="Operation" eobject="O-8"/></add-to-resource>
<set-eattribute eclass="Operation" name="name" target="O-8"><value literal="cast"/></set-eattribute>
<remove-from-resource composite="_EuXu5Cr-EeqlN5gavj_cGQ" eclass="Operation" position="4"><value eclass="Operation" eobject="O-8"/></remove-from-resource>
<add-to-ereference composite="_EuXu5Cr-EeqlN5gavj_cGQ" eclass="Class" name="operations" position="0" target="O-7"><value eclass="Operation" eobject="O-8"/></add-to-ereference>
<create eclass="Class" epackage="miniuml" id="O-9"/>
<add-to-resource eclass="Class" position="4"><value eclass="Class" eobject="O-9"/></add-to-resource>
<set-eattribute eclass="Class" name="name" target="O-9"><value literal="Knight"/></set-eattribute>
<create eclass="Operation" epackage="miniuml" id="O-10"/>
<add-to-resource eclass="Operation" position="5"><value eclass="Operation" eobject="O-10"/></add-to-resource>
<set-eattribute eclass="Operation" name="name" target="O-10"><value literal="smash"/></set-eattribute>
<remove-from-resource composite="_EuXu5Sr-EeqlN5gavj_cGQ" eclass="Operation" position="5"><value eclass="Operation" eobject="O-10"/></remove-from-resource>
<add-to-ereference composite="_EuXu5Sr-EeqlN5gavj_cGQ" eclass="Class" name="operations" position="0" target="O-9"><value eclass="Operation" eobject="O-10"/></add-to-ereference>
<create eclass="Class" epackage="miniuml" id="O-11"/>
<add-to-resource eclass="Class" position="5"><value eclass="Class" eobject="O-11"/></add-to-resource>
<set-eattribute eclass="Class" name="name" target="O-11"><value literal="Mage"/></set-eattribute>
<remove-from-resource composite="_EuXu5ir-EeqlN5gavj_cGQ" eclass="Class" position="1"><value eclass="Class" eobject="O-1"/></remove-from-resource>
<add-to-ereference composite="_EuXu5ir-EeqlN5gavj_cGQ" eclass="Model" name="classes" position="0" target="O-0"><value eclass="Class" eobject="O-1"/></add-to-ereference>
<remove-from-resource composite="_EuXu5yr-EeqlN5gavj_cGQ" eclass="Class" position="1"><value eclass="Class" eobject="O-6"/></remove-from-resource>
<add-to-ereference composite="_EuXu5yr-EeqlN5gavj_cGQ" eclass="Model" name="classes" position="1" target="O-0"><value eclass="Class" eobject="O-6"/></add-to-ereference>
<remove-from-resource composite="_EuXu6Cr-EeqlN5gavj_cGQ" eclass="Class" position="1"><value eclass="Class" eobject="O-7"/></remove-from-resource>
<add-to-ereference composite="_EuXu6Cr-EeqlN5gavj_cGQ" eclass="Model" name="classes" position="2" target="O-0"><value eclass="Class" eobject="O-7"/></add-to-ereference>
<remove-from-resource composite="_EuXu6Sr-EeqlN5gavj_cGQ" eclass="Class" position="1"><value eclass="Class" eobject="O-9"/></remove-from-resource>
<add-to-ereference composite="_EuXu6Sr-EeqlN5gavj_cGQ" eclass="Model" name="classes" position="3" target="O-0"><value eclass="Class" eobject="O-9"/></add-to-ereference>
<remove-from-resource composite="_EuXu6ir-EeqlN5gavj_cGQ" eclass="Class" position="1"><value eclass="Class" eobject="O-11"/></remove-from-resource>
<add-to-ereference composite="_EuXu6ir-EeqlN5gavj_cGQ" eclass="Model" name="classes" position="4" target="O-0"><value eclass="Class" eobject="O-11"/></add-to-ereference>
<session id="LEFT" time="20191230131531788GMT"/>
<create eclass="Generalization" epackage="miniuml" id="L-0"/>
<add-to-resource eclass="Generalization" position="1"><value eclass="Generalization" eobject="L-0"/></add-to-resource>
<set-eattribute eclass="Generalization" name="name" target="L-0"><value literal="Left Generalisation"/></set-eattribute>
<remove-from-resource composite="_ExFrsCr-EeqlN5gavj_cGQ" eclass="Generalization" position="1"><value eclass="Generalization" eobject="L-0"/></remove-from-resource>
<set-ereference composite="_ExFrsCr-EeqlN5gavj_cGQ" eclass="Class" name="generalization" target="O-6"><value eclass="Generalization" eobject="L-0"/></set-ereference>
<set-ereference eclass="Generalization" name="general" target="L-0"><value eclass="Class" eobject="O-1"/></set-ereference>
<set-eattribute eclass="Class" name="name" target="O-1"><old-value literal="Character"/><value literal="Hero"/></set-eattribute>
<unset-ereference composite="_ExFrsSr-EeqlN5gavj_cGQ" eclass="Class" name="generalization" target="O-6"><old-value eclass="Generalization" eobject="L-0"/></unset-ereference>
<set-ereference composite="_ExFrsSr-EeqlN5gavj_cGQ" eclass="Class" name="generalization" target="O-9"><value eclass="Generalization" eobject="L-0"/></set-ereference>
<move-in-ereference eclass="Operation" from="1" name="parameters" target="O-2" to="2"><value eclass="Parameter" eobject="O-4"/></move-in-ereference>
<unset-eattribute composite="_ExFrsir-EeqlN5gavj_cGQ" eclass="Operation" name="name" target="O-8"><old-value literal="cast"/></unset-eattribute>
<remove-from-ereference composite="_ExFrsir-EeqlN5gavj_cGQ" eclass="Class" name="operations" position="0" target="O-7"><value eclass="Operation" eobject="O-8"/></remove-from-ereference>
<delete composite="_ExFrsir-EeqlN5gavj_cGQ" eclass="Operation" epackage="miniuml" id="O-8"/>
<unset-eattribute composite="_ExFrsir-EeqlN5gavj_cGQ" eclass="Class" name="name" target="O-7"><old-value literal="Giant"/></unset-eattribute>
<remove-from-ereference composite="_ExFrsir-EeqlN5gavj_cGQ" eclass="Model" name="classes" position="2" target="O-0"><value eclass="Class" eobject="O-7"/></remove-from-ereference>
<delete composite="_ExFrsir-EeqlN5gavj_cGQ" eclass="Class" epackage="miniuml" id="O-7"/>
<set-eattribute eclass="Class" name="name" target="O-6"><old-value literal="Troll"/><value literal="Ogre"/></set-eattribute>
\end{lstlisting}
