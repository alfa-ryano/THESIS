\chapter{Change-based Model Persistence in XML-like Format}
\label{sec:examples_of_cbp}

\vspace{-20pt}
\begin{lstlisting}[style=xmi,caption={Simplified XMI file of the original version in Figure \ref{fig:class_diagram_origin}.},label=lst:xmimodel_origin]
<uml:Model>
<packagedElement type=Class id="character" name="Character">
<operation id="attack" name="attack">
<parameter id="gem" name="gem"/>
<parameter id="target" name="target"/>
<parameter id="weapon" name="weapon"/>
</operation>
</packagedElement>
<packagedElement type=Class id="troll" name="Troll"/>
<packagedElement type=Class id="giant" name="Giant">
<operation id="cast" name="cast"/>
</packagedElement>
<packagedElement type=Class id="knight" name="Knight">
<operation id="smash" name="smash"/>
</packagedElement>
<packagedElement type=Class id="mage" name="Mage"/>
</uml:Model>
\end{lstlisting}

\vspace{-20pt}
\begin{lstlisting}[style=xmi,caption={Simplified XMI file of the left version in Figure \ref{fig:class_diagram_left}.},label=lst:xmimodel_left]
<uml:Model>
<packagedElement type=Class id="character" name="Hero">
<operation id="attack" name="attack">
<parameter id="weapon" name="weapon"/>
<parameter id="gem" name="gem"/>
<parameter id="target" name="target"/>
</operation>  
</packagedElement>
<packagedElement type=Class id="troll" name="Ogre"/>
<packagedElement type=Class id="knight" name="Knight">
<generalization id="leftGen" general="character"/>
<operation id="smash" name="smash"/>
</packagedElement>
<packagedElement type=Class id="mage" name="Mage"/>
</uml:Model>
\end{lstlisting}

\vspace{-20pt}
\begin{lstlisting}[style=xmi,caption={Simplified XMI file of the right version of Figure \ref{fig:class_diagram_right}.},label=lst:xmimodel_right]
<uml:Model>
<packagedElement type=Class id="character" name="Character">
<operation id="attack" name="attack">
<parameter id="gem" name="gem"/>
<parameter id="weapon" name="weapon"/>
<parameter id="target" name="target"/>
</operation>
</packagedElement>
<packagedElement type=Class id="troll" name="Orc"/>
<packagedElement type=Class id="giant" name="Giant">
<operation id="smash" name="smash"/>
</packagedElement>
<packagedElement type=Class id="knight" name="Knight"/>
<packagedElement type=Class id="mage" name="Mage">
<generalization id="rightGen" general="character"/>
<operation id="cast" name="cast"/>
</packagedElement>
</uml:Model>
\end{lstlisting}





\vspace{-20pt}
\begin{lstlisting}[style=eol,escapechar=|,caption={The complete version of Bob's change events in Listing \ref{lst:cbp_left}.},label=lst:cbp_left_full]
session "Jane-01"
create character type Class
set character.name from null to "Character" 
create attack type Operation
set attack.name from null to "attack" 
add attack to character.operations at 0
create gem type Parameter
set gem.name from null to "gem" 
add gem to attack.parameters at 0
create target type Parameter
set target.name from null to "target" 
add target to attack.parameters at 1
create weapon type Parameter
set weapon.name from null to "weapon" 
add weapon to attack.parameters at 2
create troll type Class
set troll.name from null to "Troll" 
create giant type class
set giant.name from null to "Giant"
create cast type Operation
set cast.name from null to "smash"
add cast to giant.operations at 0
create knight type Class
set knight.name from null to "Knight"
create smash type Operation
set smash.name from null to "smash"
add smash to knight.operations at 0
create mage type Class
set mage.name from null to "Mage" 
session "Bob-01"
create leftGen type Generalization
set leftGen.general from null to character
set troll.generalization to leftGen
set character.name from "Character" to "Hero"
unset troll.generalization from leftGen to null composite l1
set knight.generalization to leftGen composite l1
move target in attack.parameters from 1 to 2
unset cast.name from "cast" to null composite l2
remove cast from giant.operations at 0 composite l2
delete cast composite l2
unset giant.name from "Giant" to null composite l2
delete giant composite l2
set troll.name from "Troll" to "Ogre"
\end{lstlisting}

\vspace{-20pt}
\begin{lstlisting}[style=cbpfile,caption={Change-based representation of the model in Figure \ref{fig:class_diagram_left}.},label=lst:class_diagram_left_cbpfile]
<session id="ORIGIN" time="20190923181841687GMT"/>
<register epackage="http://www.eclipse.org/uml2/5.0.0/UML"/>
<create eclass="Class" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-0"/>
<add-to-resource eclass="Class" position="0"><value eclass="Class" eobject="O-0"/></add-to-resource>
<set-eattribute eclass="Class" name="name" target="O-0"><value literal="Character"/></set-eattribute>
<create eclass="Operation" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-1"/>
<add-to-resource eclass="Operation" position="1"><value eclass="Operation" eobject="O-1"/></add-to-resource>
<set-eattribute eclass="Operation" name="name" target="O-1"><value literal="attack"/></set-eattribute>
<create eclass="Parameter" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-2"/>
<add-to-resource eclass="Parameter" position="2"><value eclass="Parameter" eobject="O-2"/></add-to-resource>
<set-eattribute eclass="Parameter" name="name" target="O-2"><value literal="gem"/></set-eattribute>
<create eclass="Parameter" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-3"/>
<add-to-resource eclass="Parameter" position="3"><value eclass="Parameter" eobject="O-3"/></add-to-resource>
<set-eattribute eclass="Parameter" name="name" target="O-3"><value literal="target"/></set-eattribute>
<create eclass="Parameter" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-4"/>
<add-to-resource eclass="Parameter" position="4"><value eclass="Parameter" eobject="O-4"/></add-to-resource>
<set-eattribute eclass="Parameter" name="name" target="O-4"><value literal="weapon"/></set-eattribute>
<remove-from-resource composite="_MTTT4N4mEemJfKIP8B_Caw" eclass="Operation" position="1"><value eclass="Operation" eobject="O-1"/></remove-from-resource>
<add-to-ereference composite="_MTTT4N4mEemJfKIP8B_Caw" eclass="Class" name="ownedOperation" position="0" target="O-0"><value eclass="Operation" eobject="O-1"/></add-to-ereference>
<add-to-ereference eclass="Operation" name="ownedParameter" position="0" target="O-1"><value eclass="Parameter" eobject="O-2"/></add-to-ereference>
<remove-from-resource composite="_MTdE4N4mEemJfKIP8B_Caw" eclass="Parameter" position="1"><value eclass="Parameter" eobject="O-2"/></remove-from-resource>
<add-to-ereference composite="_MTdE4N4mEemJfKIP8B_Caw" eclass="Operation" name="ownedParameter" position="1" target="O-1"><value eclass="Parameter" eobject="O-3"/></add-to-ereference>
<remove-from-resource composite="_MTdE4d4mEemJfKIP8B_Caw" eclass="Parameter" position="1"><value eclass="Parameter" eobject="O-3"/></remove-from-resource>
<add-to-ereference composite="_MTdE4d4mEemJfKIP8B_Caw" eclass="Operation" name="ownedParameter" position="2" target="O-1"><value eclass="Parameter" eobject="O-4"/></add-to-ereference>
<remove-from-resource eclass="Parameter" position="1"><value eclass="Parameter" eobject="O-4"/></remove-from-resource>
<create eclass="Class" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-5"/>
<add-to-resource eclass="Class" position="1"><value eclass="Class" eobject="O-5"/></add-to-resource>
<set-eattribute eclass="Class" name="name" target="O-5"><value literal="Troll"/></set-eattribute>
<create eclass="Class" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-6"/>
<add-to-resource eclass="Class" position="2"><value eclass="Class" eobject="O-6"/></add-to-resource>
<set-eattribute eclass="Class" name="name" target="O-6"><value literal="Giant"/></set-eattribute>
<create eclass="Operation" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-7"/>
<add-to-resource eclass="Operation" position="3"><value eclass="Operation" eobject="O-7"/></add-to-resource>
<set-eattribute eclass="Operation" name="name" target="O-7"><value literal="cast"/></set-eattribute>
<remove-from-resource composite="_MTdE4t4mEemJfKIP8B_Caw" eclass="Operation" position="3"><value eclass="Operation" eobject="O-7"/></remove-from-resource>
<add-to-ereference composite="_MTdE4t4mEemJfKIP8B_Caw" eclass="Class" name="ownedOperation" position="0" target="O-6"><value eclass="Operation" eobject="O-7"/></add-to-ereference>
<create eclass="Class" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-8"/>
<add-to-resource eclass="Class" position="3"><value eclass="Class" eobject="O-8"/></add-to-resource>
<set-eattribute eclass="Class" name="name" target="O-8"><value literal="Knight"/></set-eattribute>
<create eclass="Operation" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-9"/>
<add-to-resource eclass="Operation" position="4"><value eclass="Operation" eobject="O-9"/></add-to-resource>
<set-eattribute eclass="Operation" name="name" target="O-9"><value literal="smash"/></set-eattribute>
<remove-from-resource composite="_MTdE494mEemJfKIP8B_Caw" eclass="Operation" position="4"><value eclass="Operation" eobject="O-9"/></remove-from-resource>
<add-to-ereference composite="_MTdE494mEemJfKIP8B_Caw" eclass="Class" name="ownedOperation" position="0" target="O-8"><value eclass="Operation" eobject="O-9"/></add-to-ereference>
<create eclass="Class" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-10"/>
<add-to-resource eclass="Class" position="4"><value eclass="Class" eobject="O-10"/></add-to-resource>
<set-eattribute eclass="Class" name="name" target="O-10"><value literal="Mage"/></set-eattribute>
<session id="LEFT" time="20190923181843015GMT"/>
<create eclass="Generalization" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="L-0"/>
<add-to-resource eclass="Generalization" position="5"><value eclass="Generalization" eobject="L-0"/></add-to-resource>
<remove-from-resource composite="_MW4MUN4mEemJfKIP8B_Caw" eclass="Generalization" position="5"><value eclass="Generalization" eobject="L-0"/></remove-from-resource>
<add-to-ereference composite="_MW4MUN4mEemJfKIP8B_Caw" eclass="Class" name="generalization" position="0" target="O-5"><value eclass="Generalization" eobject="L-0"/></add-to-ereference>
<set-ereference eclass="Generalization" name="general" target="L-0"><value eclass="Class" eobject="O-0"/></set-ereference>
<set-eattribute eclass="Class" name="name" target="O-0"><old-value literal="Character"/><value literal="Hero"/></set-eattribute>
<remove-from-ereference composite="_MW4MUd4mEemJfKIP8B_Caw" eclass="Class" name="generalization" position="0" target="O-5"><value eclass="Generalization" eobject="L-0"/></remove-from-ereference>
<add-to-ereference composite="_MW4MUd4mEemJfKIP8B_Caw" eclass="Class" name="generalization" position="0" target="O-8"><value eclass="Generalization" eobject="L-0"/></add-to-ereference>
<move-in-ereference eclass="Operation" from="1" name="ownedParameter" target="O-1" to="2"><value eclass="Parameter" eobject="O-3"/></move-in-ereference>
<remove-from-ereference composite="_MXLHQN4mEemJfKIP8B_Caw" eclass="Class" name="ownedOperation" position="0" target="O-6"><value eclass="Operation" eobject="O-7"/></remove-from-ereference>
<delete composite="_MXLHQN4mEemJfKIP8B_Caw" eclass="Operation" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-7"/>
<remove-from-resource composite="_MXLHQN4mEemJfKIP8B_Caw" eclass="Class" position="2"><value eclass="Class" eobject="O-6"/></remove-from-resource>
<delete composite="_MXLHQN4mEemJfKIP8B_Caw" eclass="Class" epackage="http://www.eclipse.org/uml2/5.0.0/UML" id="O-6"/>
<set-eattribute eclass="Class" name="name" target="O-5"><old-value literal="Troll"/><value literal="Ogre"/></set-eattribute>

\end{lstlisting}
